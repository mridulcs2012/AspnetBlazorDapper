@page "/"
@layout LoginLayout
@using DataAccessLibrary.DataAccess;
@using DataAccessLibrary.Models;
@using DataAccessLibrary.SqlDataAccess;
@using DataAccessLibrary.Util;
@inject IAdminLogin _DbAdminLogin
@inject NavigationManager nunav
@inject SessionState State
@using System.Security.Cryptography;
@using System.Text;
@using System.Data.SqlClient;
@using System.Data;
@using Microsoft.Extensions.Configuration;

	<title>Login Page</title>

<div class="container" style="background-color:#2a9185">
		<div class="d-flex justify-content-center h-100">
			<div class="card">
				<div class="card-header">
					<h3>Sign In</h3>
					<div class="d-flex justify-content-end social_icon">
					</div>
				</div>
				<div class="card-body">
				<EditForm Model="@model" OnValidSubmit="submit">
					<div class="form-group">
						<label class="text-white">User Name</label>
						<ValidationMessage For="@(() => model.Username)" />
						<InputText class="form-control" @bind-Value="model.Username" />
					</div>
					<div class="form-group">
						<label class="text-white">Password</label>
						<ValidationMessage For="@(() => model.Password)" />
						<InputText type="password" class="form-control" @bind-Value="model.Password" />
					</div>
					<div class="col-sm-12" style="padding-top:10px; padding-bottom:10px; font-size:15px; font-weight:bold;">
						<InputCheckbox style="height:20px;width:20px;padding-right:20px;" @bind-Value="model.Remember" />                             
						<label class="text-white" style="width:200px;padding-left:20px;">Remember Me</label>
						<input type="submit" style="padding-left:0px; width:100px;" value="Login" class="btn btn-warning">

					</div>
					<div style="color:red;font-size:large">
						@massege
					</div>
				</EditForm>
				</div>
				<div class="card-footer">
					<div class="d-flex justify-content-center links">
					Don't have an account?<a href="/Registration">Sign Up</a>
					</div>
					<div class="d-flex justify-content-center">
						
					@* <a @onclick="Forgot" style="color:green">Forgot your password?</a> *@
					<input type="submit" @onclick="Forgot" style="padding-left:0px; background-color:transparent; color:green; border-color:transparent;" value="Forgot your password?" class="btn btn-warning">
					</div>
				</div>
			</div>
		</div>
	</div>



@code{
	bool rememberMe=true;
	private IHttpContextAccessor Accessor;
	IHttpContextAccessor _accessor;
	
	AdminModel model = new AdminModel();
	Encrypt encrypt1 = new Encrypt();
	string? massege;

	List<AdminModel> adminList;
	[Inject]

	public IAdminLogin AdminLogin { get; set; }
	protected override void OnInitialized()
	{
		this.GetAllData1();
	}
	public void GetAllData1()
	{
		adminList = AdminLogin.GetAllDataInd(State.username);
	}

	private void submit()
	{
		adminList = AdminLogin.GetAllDataInd(model.Username);
		if (adminList.Any(a => a.Username.Equals(model.Username) && encrypt1.DecryptString(a.Password, "1").Equals(model.Password)))
		{
			State.username = adminList[0].Username;
			State.email = adminList[0].Email;
			State.mobile = adminList[0].Mobile;
			State.empid = adminList[0].EmployeeID;
			State.empname = adminList[0].Name;
			State.userroleid = adminList[0].UserRoleId;
			State.id = adminList[0].Id;
			// if (rememberme.checked)
			// {

			// }
			// else
			// {
				
			// }
			nunav.NavigateTo("/Index");
		}
		else
		{
			massege = "Your ID or Password is wrong";
		}
	}

	private void Forgot()
	{
		// State = null;
		// nunav.NavigateTo("/forgot");
	}
	private void Registration()
	{
		// State = null;
		// nunav.NavigateTo("/forgot1");
	}




}

